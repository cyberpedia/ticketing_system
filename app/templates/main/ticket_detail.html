{% extends 'base.html' %}
{% block title %}Ticket #{{ ticket.id }}{% endblock %}
{% block content %}
<h2>Ticket #{{ ticket.id }} - {{ ticket.subject }}</h2>
<p>Status: <strong>{{ ticket.status }}</strong></p>
<p>Submitted by: {{ ticket.user.username }}</p>
<p>Description: {{ ticket.description }}</p>
{% if ticket.attachment %}
<p>Attachment: <a href="{{ url_for('static', filename='uploads/' ~ ticket.attachment) }}" target="_blank">View</a></p>
{% endif %}

<hr>
<h4>Replies</h4>
{% for reply in ticket.replies %}
<div class="card mb-2">
    <div class="card-body">
        <strong>{{ reply.user.username }}</strong> - <small>{{ reply.created_at.strftime('%Y-%m-%d %H:%M') }}</small>
        <p>{{ reply.message }}</p>
        {% if reply.attachment %}
        <p><a href="{{ url_for('static', filename='uploads/' ~ reply.attachment) }}" target="_blank">Attachment</a></p>
        {% endif %}
    </div>
</div>
{% endfor %}

<hr>
<h4>Post a Reply</h4>
<form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    <div class="mb-3">{{ form.message.label }} {{ form.message(class="form-control") }}</div>
    <div class="mb-3">{{ form.attachment.label }} {{ form.attachment(class="form-control") }}</div>
    <div class="mb-3">{{ form.submit(class="btn btn-primary") }}</div>
</form>
{% endblock %}
